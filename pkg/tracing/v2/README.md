<!-- Code generated by gomarkdoc. DO NOT EDIT -->

[![pipeline status](https://github.com/jkrus/master_api/app/pkg/tracing/badges/develop/pipeline.svg)](https://github.com/jkrus/master_api/app/pkg/tracing/-/commits/develop)
[![coverage report](https://github.com/jkrus/master_api/app/pkg/tracing/badges/develop/coverage.svg)](http://go-modules.pages.gitlab.sigma-it.ru/tracing/coverage.html)

# tracing

```go
import "github.com/jkrus/master_api/app/pkg/tracing"
```

Package tracing библиотека для работы с jaeger трейсером

<details><summary>Example (Middleware HTTP)</summary>
<p>

```go
package main

import (
	"context"
	"log"
	"net/http"

	"github.com/opentracing/opentracing-go"

	"github.com/jkrus/master_api/pkg/tracing"
)

type HTTPTracingMiddleware struct {
	tracer opentracing.Tracer
	next   http.Handler
}

func (m *HTTPTracingMiddleware) ServeHTTP(w http.ResponseWriter, r *http.Request) {
	span, err := tracing.StartSpanFromRequest(m.tracer, r)
	if err != nil {
		log.Print(err)
	}

	defer span.Finish()

	ctx := opentracing.ContextWithSpan(r.Context(), span)
	traceID := tracing.TraceIDFromSpan(span)
	w.Header().Set(tracing.TraceRequestID, traceID)

	m.next.ServeHTTP(w, r.WithContext(ctx))
}

func main() {
	tracer, closer, err := tracing.FromConfig(context.Background(), "some-app-name", nil)
	if err != nil {
		log.Fatalln(err)
	}

	middleware := &HTTPTracingMiddleware{
		tracer: tracer,
		next:   http.NewServeMux(),
	}

	server := &http.Server{
		Addr:    "localhost:8080",
		Handler: middleware,
	}

	if err = server.ListenAndServe(); err != nil {
		closer()
		log.Fatalln(err)
	}
}
```

</p>
</details>

## Index

- [Constants](<#constants>)
- [func FollowCallerSpan(ctx context.Context, opts ...opentracing.StartSpanOption) opentracing.Span](<#func-followcallerspan>)
- [func FollowCallerWithContext(
    ctx context.Context,
    opts ...opentracing.StartSpanOption,
) (context.Context, opentracing.Span)](<#func-followcallerwithcontext>)
- [func FollowSpan(ctx context.Context, operationName string, opts ...opentracing.StartSpanOption) opentracing.Span](<#func-followspan>)
- [func FollowWithContext(
    ctx context.Context,
    operationName string,
    opts ...opentracing.StartSpanOption,
) (context.Context, opentracing.Span)](<#func-followwithcontext>)
- [func InjectSpanToAMQPHeader(span opentracing.Span, header amqp.Table) error](<#func-injectspantoamqpheader>)
- [func InjectSpanToRequest(span opentracing.Span, r *http.Request) error](<#func-injectspantorequest>)
- [func LogError(span opentracing.Span, err error)](<#func-logerror>)
- [func NewSpanWrapper(span opentracing.Span) opentracing.Span](<#func-newspanwrapper>)
- [func SpanIDFromSpan(span opentracing.Span) string](<#func-spanidfromspan>)
- [func StartSpanFromAMQPHeader(operationName string, tracer opentracing.Tracer, header amqp.Table) (opentracing.Span, error)](<#func-startspanfromamqpheader>)
- [func StartSpanFromRequest(tracer opentracing.Tracer, r *http.Request) (opentracing.Span, error)](<#func-startspanfromrequest>)
- [func TraceIDFromSpan(span opentracing.Span) string](<#func-traceidfromspan>)
- [type CloseFunc](<#type-closefunc>)
  - [func FromConfig(
    ctx context.Context,
    serviceName string,
    tConf tracingcfg.TraceConfiger,
    opts ...config.Option,
) (opentracing.Tracer, CloseFunc, error)](<#func-fromconfig>)


## Constants

```go
const (
    // TraceRequestID идентификатор для трасировки запроса через все сервисы. Генерируется в "точках входа",
    // например erpi.
    // В случае использования jaegertracing этот идентификатор совпадает с root-span-id (не путать с полем ниже).
    TraceRequestID = "trace-request-id"
    // ClientRequestID  идентификатор для трасировки запроса через все сервисы.
    // Задаётся клиентом для возможности отследить свой запрос.
    ClientRequestID = "client-request-id"
    // SpanRequestID последовательность идентификаторов вызовов от сервиса к сервису. Каждый раз как один сервис
    // вызывает метод другого, в начало этого списка он добавляет новый идентификатор. Таким образом можно построить
    // дерево вызовов. (не путать эти спаны со спанами jaeger)
    SpanRequestID = "span-request-id"
)
```

## func [FollowCallerSpan](<https://github.com/jkrus/master_api/app/pkg/tracing/blob/develop/span.go#L61>)

```go
func FollowCallerSpan(ctx context.Context, opts ...opentracing.StartSpanOption) opentracing.Span
```

FollowCallerSpan \- возвращает следующий спан в цепочке трейсинга\, в качестве operationName подставляется имя вызывающего метода

## func [FollowCallerWithContext](<https://github.com/jkrus/master_api/app/pkg/tracing/blob/develop/span.go#L84-L87>)

```go
func FollowCallerWithContext(
    ctx context.Context,
    opts ...opentracing.StartSpanOption,
) (context.Context, opentracing.Span)
```

FollowCallerWithContext возвращает следующий спан в цепочке трейсинга\, в качестве operationName подставляется имя вызывающего метода\, а также контекст с этим спаном

## func [FollowSpan](<https://github.com/jkrus/master_api/app/pkg/tracing/blob/develop/span.go#L51>)

```go
func FollowSpan(ctx context.Context, operationName string, opts ...opentracing.StartSpanOption) opentracing.Span
```

FollowSpan возвращает следующий спан в цепочке трейсинга\.

## func [FollowWithContext](<https://github.com/jkrus/master_api/app/pkg/tracing/blob/develop/span.go#L68-L72>)

```go
func FollowWithContext(
    ctx context.Context,
    operationName string,
    opts ...opentracing.StartSpanOption,
) (context.Context, opentracing.Span)
```

FollowWithContext возвращает дочерний спан на основе родительского полученного из контекста

## func [InjectSpanToAMQPHeader](<https://github.com/jkrus/master_api/app/pkg/tracing/blob/develop/rabbitmq.go#L34>)

```go
func InjectSpanToAMQPHeader(span opentracing.Span, header amqp.Table) error
```

InjectSpanToAMQPHeader добавляет спан в заголовки AMQP сообщения

## func [InjectSpanToRequest](<https://github.com/jkrus/master_api/app/pkg/tracing/blob/develop/http.go#L48>)

```go
func InjectSpanToRequest(span opentracing.Span, r *http.Request) error
```

InjectSpanToRequest помещает контекст спана в http запрос

## func [LogError](<https://github.com/jkrus/master_api/app/pkg/tracing/blob/develop/log.go#L14>)

```go
func LogError(span opentracing.Span, err error)
```

LogError \- устанавливает событие ошибки в спане

## func [NewSpanWrapper](<https://github.com/jkrus/master_api/app/pkg/tracing/blob/develop/span.go#L32>)

```go
func NewSpanWrapper(span opentracing.Span) opentracing.Span
```

NewSpanWrapper конструктор обертки спана

## func [SpanIDFromSpan](<https://github.com/jkrus/master_api/app/pkg/tracing/blob/develop/ids.go#L17>)

```go
func SpanIDFromSpan(span opentracing.Span) string
```

SpanIDFromSpan извлекает SpanID span'а

## func [StartSpanFromAMQPHeader](<https://github.com/jkrus/master_api/app/pkg/tracing/blob/develop/rabbitmq.go#L44>)

```go
func StartSpanFromAMQPHeader(operationName string, tracer opentracing.Tracer, header amqp.Table) (opentracing.Span, error)
```

StartSpanFromAMQPHeader извлекает спан из заголовков AMQP сообщения или открывает новый

## func [StartSpanFromRequest](<https://github.com/jkrus/master_api/app/pkg/tracing/blob/develop/http.go#L14>)

```go
func StartSpanFromRequest(tracer opentracing.Tracer, r *http.Request) (opentracing.Span, error)
```

StartSpanFromRequest стартует спан по данным запроса\, если контекст спана отсутсвует в запросе \- создается новый родительский спан

## func [TraceIDFromSpan](<https://github.com/jkrus/master_api/app/pkg/tracing/blob/develop/ids.go#L10>)

```go
func TraceIDFromSpan(span opentracing.Span) string
```

TraceIDFromSpan извлекает TraceID span'а

## type [CloseFunc](<https://github.com/jkrus/master_api/app/pkg/tracing/blob/develop/tracer.go#L17>)

CloseFunc метод закрытия трейсера

```go
type CloseFunc func()
```

### func [FromConfig](<https://github.com/jkrus/master_api/app/pkg/tracing/blob/develop/tracer.go#L20-L25>)

```go
func FromConfig(
    ctx context.Context,
    serviceName string,
    tConf tracingcfg.TraceConfiger,
    opts ...config.Option,
) (opentracing.Tracer, CloseFunc, error)
```

FromConfig конструктор opentracing\.Tracer из конфига



Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
